# Task 체크리스트 (Tasks Checklist)

출결 관리 자동 캡처 프로그램 개발 Task 목록입니다.

---

## ⚠️ 개발 시 필수 규칙

### Phase 시작 전
1. 이전 Phase의 주요 기능이 실제로 동작하는지 확인
2. `docs/rules.md` 다시 읽기 (코딩 규칙 상기)
3. Git 브랜치 생성 (`feature/xxx`)

### Task 완료 후
1. 실제로 동작하는지 테스트 (수동 실행)
2. rules.md 기준으로 코드 리뷰
   - 네이밍 규칙 (snake_case, PascalCase)
   - Docstring 작성
   - Type Hints 추가
   - 함수 길이 50줄 이하
   - 에러 처리 (try-except)
3. Git 커밋 (`feat:`, `fix:`, `docs:` 등)

---

## 📋 Phase 1: 핵심 기능 (Core Features)

### 1.1 프로젝트 초기 설정
- [x] 프로젝트 폴더 구조 생성 (`features/`, `gui/`, `utils/`)
- [x] `requirements.txt` 작성
- [x] Git 저장소 초기화 및 `.gitignore` 설정
- [ ] 가상환경 생성 (Python 3.10.11)
- [ ] 기본 라이브러리 설치 (InsightFace, mss, Pillow 등)

### 1.2 초기 설정 GUI
- [ ] `gui/dialogs.py` 생성
- [ ] `InitDialog` 클래스 구현
- [ ] 모니터 선택 UI (드롭다운)
- [ ] 저장 경로 선택 UI (폴더 선택 버튼)
- [ ] 캡처 모드 선택 UI (정확/유연)
- [ ] 출석 학생 수 입력 UI (텍스트 + ▲▼ 버튼)
- [ ] 확인/취소 버튼
- [ ] 입력값 검증 (학생 수 1~100명)
- [ ] 초기 설정 결과 반환 (dict)

### 1.3 메인 GUI
- [ ] `gui/main_window.py` 생성
- [ ] `MainWindow` 클래스 기본 구조
- [ ] `__init__()`: tkinter 윈도우 생성
- [ ] `setup_ui()`: UI 배치
- [ ] 상단 정보 영역 UI
- [ ] 날짜 표시 (실시간)
- [ ] 시간 표시 (1초 업데이트)
- [ ] 현재 상태 표시 (다음 교시까지 남은 시간)
- [ ] 캡처 모니터 표시 및 [변경] 버튼
- [ ] 인원 관리 영역 UI
- [ ] 캡처 모드 드롭다운
- [ ] 출석 학생 수 입력 (텍스트 + ▲▼)
- [ ] 기준 인원 표시 (자동 계산)
- [ ] 교시별 상태 영역 UI
- [ ] 1~8교시 + 퇴실 상태 표시
- [ ] [건너뛰기] [재시도] 버튼 (각 교시별)
- [ ] 상태 아이콘 (🕒 대기중, 🔍 감지중, ✅ 완료 등)
- [ ] 하단 버튼 영역 UI
- [ ] [📁 저장 경로 설정] 버튼
- [ ] [📂 저장 폴더 열기] 버튼

### 1.4 모니터 선택 기능
- [ ] `utils/monitor.py` 생성
- [ ] 모니터 목록 조회 함수 구현
- [ ] 모니터 정보 반환 함수 구현 (해상도, 위치)
- [ ] 듀얼 모니터 환경 테스트

### 1.5 화면 캡처 기능
- [ ] `features/capture.py` 생성
- [ ] `ScreenCapture` 클래스 구현
- [ ] `__init__()`: 모니터 ID 초기화
- [ ] `capture()`: 화면 캡처 메서드
- [ ] `get_monitor_info()`: 모니터 정보 조회
- [ ] mss 라이브러리로 캡처 구현
- [ ] 캡처 이미지 RGB 변환
- [ ] 캡처 기능 단위 테스트

### 1.6 얼굴 감지 기능
- [ ] `features/face_detection.py` 생성
- [ ] `FaceDetector` 클래스 구현
- [ ] `__init__()`: GPU ID 설정
- [ ] `initialize()`: InsightFace 모델 로드
- [ ] `detect()`: 얼굴 감지 및 개수 반환
- [ ] `cleanup()`: GPU 메모리 해제
- [ ] InsightFace buffalo_l 모델 다운로드 및 테스트
- [ ] GPU 감지 실패 시 CPU 전환 로직
- [ ] 얼굴 감지 정확도 테스트 (95% 이상)

### 1.7 파일 저장 기능
- [ ] `features/file_manager.py` 생성
- [ ] `FileManager` 클래스 구현
- [ ] `__init__()`: 기본 저장 경로 설정
- [ ] `save_image()`: 이미지 저장 (교시별)
- [ ] `ensure_folder_exists()`: 날짜 폴더 생성
- [ ] `get_file_path()`: 파일 경로 생성
- [ ] 파일명 규칙 구현 (YYMMDD_N교시.png)
- [ ] 덮어쓰기 vs 수정본 로직 구현
- [ ] 파일 저장 권한 에러 처리

### 1.8 스케줄링 기능
- [ ] `features/scheduler.py` 생성
- [ ] `CaptureScheduler` 클래스 구현
- [ ] `__init__()`: 스케줄 목록 초기화
- [ ] `add_schedule()`: 스케줄 추가
- [ ] `start()`: 스케줄러 시작
- [ ] `stop()`: 스케줄러 중지
- [ ] `skip_period()`: 건너뛰기
- [ ] `is_in_capture_window()`: 캡처 시간대 확인
- [ ] 8교시 + 퇴실 스케줄 등록 (09:30~09:45, ...)
- [ ] 10초 간격 재시도 로직
- [ ] 스케줄러 동작 테스트

### 1.9 알림창
- [ ] `MainWindow.show_alert()` 메서드 구현
- [ ] 성공 알림창 (캡처 완료)
- [ ] 실패 알림창 (얼굴 감지 실패)
- [ ] 에러 알림창 (파일 저장 실패 등)

### 1.10 메인 프로그램
- [ ] `main.py` 생성
- [ ] 초기 설정 다이얼로그 표시
- [ ] Features 인스턴스 생성 (Capture, Detector, FileManager, Scheduler)
- [ ] 메인 윈도우 시작
- [ ] 프로그램 종료 시 cleanup 처리

---

## 📋 Phase 2: 제어 기능 (Control Features)

### 2.1 인원 관리
- [ ] 실시간 학생 수 변경 기능
- [ ] 텍스트 입력 시 즉시 적용
- [ ] ▲ 버튼 (+1)
- [ ] ▼ 버튼 (-1)
- [ ] 기준 인원 자동 재계산 (학생 수 + 1)
- [ ] 입력값 검증 (1~100)

### 2.2 캡처 모드 (정확/유연)
- [ ] 정확 모드 로직 (감지 인원 == 기준 인원)
- [ ] 유연 모드 로직 (감지 인원 >= 기준 인원 × 0.9)
- [ ] 모드 전환 시 즉시 적용
- [ ] 현재 모드 표시

### 2.3 건너뛰기 기능
- [ ] `MainWindow.on_skip_button()` 구현
- [ ] 해당 교시 자동 감지 중단
- [ ] 상태 변경 (🔍 감지중 → ⏭️ 건너뛰기)
- [ ] 건너뛴 교시 로그 기록

### 2.4 재시도 기능
- [ ] `MainWindow.on_retry_button()` 구현
- [ ] 캡처 시간대 확인
- [ ] 시간대 내: 즉시 재시도 + 덮어쓰기
- [ ] 시간대 종료 후: 즉시 재시도 + _수정.png
- [ ] 상태 초기화 (대기중 → 감지 시작)
- [ ] 재시도 로그 기록

### 2.5 CSV 로깅
- [ ] `features/logger.py` 생성
- [ ] `CSVLogger` 클래스 구현
- [ ] `__init__()`: 로그 파일 경로 설정
- [ ] `log_event()`: 이벤트 기록
- [ ] `_ensure_log_file()`: 로그 파일 생성 (헤더 포함)
- [ ] CSV 구조 정의 (날짜, 시간, 항목, 상태, 감지인원, 기준인원, 파일명, 비고)
- [ ] UTF-8-BOM 인코딩 (Excel 호환)
- [ ] 모든 주요 이벤트 로그 기록
- [ ] 캡처 시작
- [ ] 얼굴 감지 (실패/성공)
- [ ] 파일 저장
- [ ] 건너뛰기
- [ ] 재시도

---

## 📋 Phase 3: 추가 기능 (Additional Features)

### 3.1 설정 저장/로드
- [ ] `utils/config.py` 생성
- [ ] `Config` 클래스 구현
- [ ] `load()`: 설정 파일 읽기
- [ ] `save()`: 설정 파일 쓰기
- [ ] `get()`: 설정 값 조회
- [ ] `set()`: 설정 값 저장
- [ ] config.json 구조 정의
- [ ] 프로그램 시작 시 설정 로드
- [ ] 프로그램 종료 시 설정 저장
- [ ] 설정 파일 없을 시 기본값 사용

### 3.2 저장 경로 변경
- [ ] [📁 저장 경로 설정] 버튼 구현
- [ ] 폴더 선택 다이얼로그
- [ ] 경로 변경 시 폴더 생성 확인
- [ ] 변경된 경로 config.json에 저장

### 3.3 저장 폴더 열기
- [ ] [📂 저장 폴더 열기] 버튼 구현
- [ ] 탐색기로 폴더 열기 (Windows)
- [ ] 폴더 없을 시 에러 처리

### 3.4 모니터 변경
- [ ] [변경] 버튼 구현 (캡처 모니터 옆)
- [ ] 모니터 선택 다이얼로그
- [ ] 변경 시 즉시 적용
- [ ] 변경된 모니터 ID config.json에 저장

### 3.5 GPU/CPU 자동 전환
- [ ] GPU 사용 가능 여부 확인
- [ ] GPU 실패 시 CPU 모드로 자동 전환
- [ ] 전환 시 경고 알림창
- [ ] 현재 사용 중인 모드 로그 기록

---

## 📋 Phase 4: 최적화 및 마무리 (Optimization & Finalization)

### 4.1 성능 최적화
- [ ] FaceDetector 인스턴스 재사용
- [ ] 이미지 처리 후 메모리 해제 (`del image`)
- [ ] 파일 저장 비동기 처리 (선택사항)
- [ ] 성능 프로파일링
- [ ] 화면 캡처 시간 측정 (목표: 0.5초)
- [ ] 얼굴 감지 시간 측정 (목표: 0.5초)
- [ ] 파일 저장 시간 측정 (목표: 0.5초)
- [ ] 총 처리 시간 확인 (목표: 2초 이하)

### 4.2 예외 처리 강화
- [ ] 모든 외부 호출 try-except 처리
- [ ] 커스텀 예외 클래스 정의
- [ ] `ScreenCaptureError`
- [ ] `FaceDetectionError`
- [ ] `GPUNotAvailableError`
- [ ] `FileSaveError`
- [ ] `SchedulerError`
- [ ] 에러 발생 시 로깅 및 알림
- [ ] 복구 가능한 에러는 재시도
- [ ] 치명적 에러는 안전 종료

### 4.3 코드 리팩토링
- [ ] rules.md 준수 확인
- [ ] 파일명/클래스명/변수명 체크
- [ ] Docstring 작성 확인
- [ ] Type Hints 추가 확인
- [ ] 함수 길이 50줄 이하 확인
- [ ] 클래스 길이 500줄 이하 확인
- [ ] Import 순서 정리
- [ ] 중복 코드 제거
- [ ] Magic Number → 상수로 변경
- [ ] 주석 정리 및 보완

### 4.4 테스트
- [ ] 단위 테스트 작성 (선택사항)
- [ ] `tests/test_capture.py`
- [ ] `tests/test_face_detection.py`
- [ ] `tests/test_file_manager.py`
- [ ] `tests/test_scheduler.py`
- [ ] 통합 테스트
- [ ] 전체 교시 캡처 테스트
- [ ] 10시간 안정성 테스트
- [ ] 메모리 누수 확인
- [ ] 예외 상황 테스트
- [ ] 권한 없는 폴더 저장
- [ ] 디스크 공간 부족
- [ ] GPU 사용 불가
- [ ] 모니터 연결 해제
- [ ] Zoom 없는 상태

### 4.5 문서화
- [ ] README.md 작성
- [ ] 프로젝트 소개
- [ ] 시스템 요구사항
- [ ] 설치 방법
- [ ] 사용 방법
- [ ] 트러블슈팅
- [ ] requirements.txt 최종 확인
- [ ] 주석 및 Docstring 최종 검토
- [ ] CHANGELOG.md 작성 (선택사항)

### 4.6 배포 준비
- [ ] GPU 드라이버 설치 가이드 작성
- [ ] CUDA Toolkit 설치 가이드 작성
- [ ] 프로그램 실행 방법 문서화
- [ ] InsightFace 모델 자동 다운로드 확인
- [ ] 초기 설정 가이드 작성
- [ ] 최종 테스트 (실제 환경)

### 4.7 Git 관리
- [ ] 브랜치 전략 적용 (GitHub Flow)
- [ ] feature 브랜치별 개발
- [ ] 커밋 메시지 규칙 준수 (feat:, fix:, docs: 등)
- [ ] main 브랜치 병합
- [ ] 버전 태그 생성 (v0.1.0, v0.2.0 등)

---

## 💡 개발 팁

### 권장 개발 순서 (GUI 우선)
1. **프로젝트 초기 설정** → 환경부터 구축
2. **초기 설정 GUI** → 사용자 입력 받기 (기능 없어도 OK)
3. **메인 GUI** → 레이아웃 확인 (더미 데이터 표시)
4. **모니터 선택 기능** → 실제 모니터 감지
5. **화면 캡처** → GUI에 [테스트 캡처] 버튼 추가하여 즉시 확인
6. **얼굴 감지** → GUI에 [테스트 감지] 버튼 추가하여 즉시 확인
7. **파일 저장** → GUI에 [테스트 저장] 버튼 추가하여 즉시 확인
8. **스케줄링** → 실제 시간대에 자동 캡처 테스트
9. **나머지 기능** → 점진적으로 추가

---

**문서 버전**: 1.1  
**최종 수정일**: 2025-10-24